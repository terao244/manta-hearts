# Manta 開発TODO

このドキュメントは、Mantaプロジェクトの詳細な開発タスクリストです。
各タスクは完了時にチェックし、git commitを行います。

## 凡例
- [ ] 未着手
- [x] 完了
- 🧪 テスト作成を含むタスク
- 📝 ドキュメント作成を含むタスク
- 🔧 設定・環境構築タスク

---

## Phase 1: 基盤構築

### 1. プロジェクト初期化
- [ ] 🔧 frontend/backendディレクトリ作成
- [ ] 🔧 ルートpackage.json作成（workspace設定）
- [ ] 🔧 .gitignore更新（.env, node_modules, build等）
- [ ] 🔧 .env.exampleファイル作成

### 2. Docker環境構築
- [ ] 🔧 docker-compose.yml作成（PostgreSQL, frontend, backend）
- [ ] 🔧 Dockerfile作成（frontend用）
- [ ] 🔧 Dockerfile作成（backend用）
- [ ] 🔧 .dockerignore作成
- [ ] 🧪 Docker環境起動テスト

### 3. バックエンド初期設定
- [ ] 🔧 backend/package.json作成
- [ ] 🔧 backend/tsconfig.json設定
- [ ] 🔧 ESLint設定（backend/.eslintrc.json）
- [ ] 🔧 Prettier設定（backend/.prettierrc）
- [ ] 🔧 Jest設定（backend/jest.config.js）
- [ ] 🔧 nodemon設定（開発用）

### 4. フロントエンド初期設定
- [ ] 🔧 Next.jsプロジェクト作成（npx create-next-app）
- [ ] 🔧 TypeScript厳密モード設定
- [ ] 🔧 Tailwind CSS設定
- [ ] 🔧 ESLint設定更新
- [ ] 🔧 Jest + React Testing Library設定

---

## Phase 2: データベース層構築

### 5. Prisma初期設定
- [ ] 🔧 backend/prisma/schema.prisma作成
- [ ] 🔧 DATABASE_URL環境変数設定
- [ ] 🧪 Prisma接続テスト作成・実行

### 6. スキーマ定義（基本テーブル）
- [ ] 📝 Playerモデル定義
- [ ] 📝 Cardモデル定義
- [ ] 📝 Gameモデル定義
- [ ] 📝 Handモデル定義
- [ ] 📝 Trickモデル定義

### 7. スキーマ定義（詳細テーブル）
- [ ] 📝 HandCardモデル定義
- [ ] 📝 CardExchangeモデル定義
- [ ] 📝 TrickCardモデル定義
- [ ] 📝 HandScoreモデル定義
- [ ] 📝 GameSessionモデル定義

### 8. スキーマ定義（統計テーブル）
- [ ] 📝 PlayerStatisticsモデル定義
- [ ] 📝 MonthlyStatisticsモデル定義

### 9. データベース初期化
- [ ] 🔧 初期マイグレーション実行
- [ ] 📝 seed.tsファイル作成
- [ ] 📝 プレイヤーマスターデータ投入スクリプト
- [ ] 📝 カードマスターデータ投入スクリプト
- [ ] 🧪 seedデータ投入テスト

---

## Phase 3: バックエンドAPI基盤

### 10. Express基本設定
- [ ] 🧪 server.tsのテスト作成
- [ ] 📝 server.ts実装（Express起動）
- [ ] 📝 CORS設定
- [ ] 📝 エラーハンドリングミドルウェア
- [ ] 📝 ロギング設定（morgan）

### 11. 基本APIエンドポイント
- [ ] 🧪 GET /health テスト作成
- [ ] 📝 GET /health 実装
- [ ] 🧪 GET /api/players テスト作成
- [ ] 📝 GET /api/players 実装

### 12. Prismaサービス層
- [ ] 🧪 PrismaServiceテスト作成
- [ ] 📝 PrismaService実装（シングルトン）
- [ ] 🧪 PlayerRepositoryテスト作成
- [ ] 📝 PlayerRepository実装

---

## Phase 4: ゲームロジック実装

### 13. カード関連ユーティリティ
- [ ] 🧪 Card型定義テスト
- [ ] 📝 Card型定義（types/card.ts）
- [ ] 🧪 デッキ生成関数テスト
- [ ] 📝 デッキ生成関数実装
- [ ] 🧪 シャッフル関数テスト
- [ ] 📝 シャッフル関数実装

### 14. ゲームルールエンジン
- [ ] 🧪 カード配布ロジックテスト
- [ ] 📝 カード配布ロジック実装
- [ ] 🧪 カード交換ルールテスト
- [ ] 📝 カード交換ルール実装
- [ ] 🧪 有効カード判定テスト
- [ ] 📝 有効カード判定実装
- [ ] 🧪 トリック勝者判定テスト
- [ ] 📝 トリック勝者判定実装

### 15. スコア計算
- [ ] 🧪 基本スコア計算テスト
- [ ] 📝 基本スコア計算実装
- [ ] 🧪 ハートブレイク判定テスト
- [ ] 📝 ハートブレイク判定実装
- [ ] 🧪 シュートザムーンテスト
- [ ] 📝 シュートザムーン実装

### 16. ゲーム状態管理
- [ ] 🧪 GameStateクラステスト
- [ ] 📝 GameStateクラス実装
- [ ] 🧪 状態遷移テスト
- [ ] 📝 状態遷移実装
- [ ] 🧪 ゲーム終了判定テスト
- [ ] 📝 ゲーム終了判定実装

---

## Phase 5: Socket.io通信層

### 17. Socket.io基本設定
- [ ] 🔧 Socket.ioサーバー設定
- [ ] 📝 接続イベントハンドラ
- [ ] 📝 切断イベントハンドラ
- [ ] 🧪 Socket.io接続テスト

### 18. ルーム管理
- [ ] 🧪 RoomManagerテスト作成
- [ ] 📝 RoomManager実装
- [ ] 🧪 プレイヤー参加テスト
- [ ] 📝 プレイヤー参加処理
- [ ] 🧪 ゲーム開始条件テスト
- [ ] 📝 ゲーム開始条件チェック

### 19. ゲームイベント定義
- [ ] 📝 イベント型定義（shared/types）
- [ ] 📝 JOIN_GAMEイベント
- [ ] 📝 START_GAMEイベント
- [ ] 📝 EXCHANGE_CARDSイベント
- [ ] 📝 PLAY_CARDイベント
- [ ] 📝 GAME_STATEイベント

---

## Phase 6: フロントエンド基本実装

### 20. 共通コンポーネント
- [ ] 🧪 Cardコンポーネントテスト
- [ ] 📝 Cardコンポーネント実装
- [ ] 🧪 PlayerInfoコンポーネントテスト
- [ ] 📝 PlayerInfoコンポーネント実装
- [ ] 📝 レイアウトコンポーネント

### 21. Socket.ioクライアント
- [ ] 📝 Socket接続フック作成
- [ ] 📝 イベントリスナーフック
- [ ] 📝 エラーハンドリング
- [ ] 🧪 接続状態管理テスト

### 22. 状態管理
- [ ] 📝 GameContext作成
- [ ] 📝 PlayerContext作成
- [ ] 📝 型定義（types/game.ts）
- [ ] 🧪 Context動作テスト

### 23. ログイン画面
- [ ] 🧪 ログイン画面テスト
- [ ] 📝 プレイヤー選択UI
- [ ] 📝 接続処理
- [ ] 📝 エラー表示

### 24. 待機室画面
- [ ] 🧪 待機室画面テスト
- [ ] 📝 接続プレイヤー表示
- [ ] 📝 ゲーム開始ボタン
- [ ] 📝 自動開始処理

---

## Phase 7: ゲーム画面実装

### 25. ゲームボード
- [ ] 📝 ゲームボードレイアウト
- [ ] 📝 プレイヤー配置（東西南北）
- [ ] 📝 中央エリア（トリック表示）
- [ ] 📝 スコア表示エリア

### 26. カード表示・操作
- [ ] 📝 手札表示コンポーネント
- [ ] 📝 カード選択UI
- [ ] 📝 カードプレイアニメーション
- [ ] 📝 有効カードハイライト

### 27. カード交換フェーズ
- [ ] 🧪 カード交換UIテスト
- [ ] 📝 3枚選択UI
- [ ] 📝 交換確定ボタン
- [ ] 📝 交換アニメーション

### 28. ゲーム進行表示
- [ ] 📝 現在のトリック表示
- [ ] 📝 獲得カード表示
- [ ] 📝 ハートブレイク表示
- [ ] 📝 手番インジケータ

---

## Phase 8: データ永続化

### 29. ゲーム保存処理
- [ ] 🧪 ゲーム作成APIテスト
- [ ] 📝 ゲーム作成API実装
- [ ] 🧪 ハンド保存テスト
- [ ] 📝 ハンド保存実装
- [ ] 🧪 トリック保存テスト
- [ ] 📝 トリック保存実装

### 30. リアルタイム同期
- [ ] 📝 状態変更→DB保存
- [ ] 📝 DB保存→クライアント通知
- [ ] 🧪 同期テスト

---

## Phase 2: 利便性向上機能

### 31. スコアグラフ
- [ ] 🔧 Chart.js設定
- [ ] 🧪 ScoreGraphコンポーネントテスト
- [ ] 📝 ScoreGraphコンポーネント実装
- [ ] 📝 リアルタイム更新処理
- [ ] 📝 グラフオプション調整

### 32. 切断・再接続
- [ ] 🧪 セッション管理テスト
- [ ] 📝 セッション保存処理
- [ ] 📝 再接続ハンドラ
- [ ] 📝 状態復元処理
- [ ] 📝 再接続UI表示

### 33. エラーハンドリング
- [ ] 📝 グローバルエラーハンドラ
- [ ] 📝 エラー通知コンポーネント
- [ ] 📝 リトライ処理
- [ ] 📝 エラーログ送信

---

## Phase 3: 体験向上機能

### 34. ゲーム履歴API
- [ ] 🧪 GET /api/games テスト
- [ ] 📝 GET /api/games 実装（一覧）
- [ ] 🧪 GET /api/games/:id テスト
- [ ] 📝 GET /api/games/:id 実装（詳細）

### 35. 履歴画面
- [ ] 📝 ゲーム一覧画面
- [ ] 📝 ゲーム詳細画面
- [ ] 📝 ハンド詳細表示
- [ ] 📝 リプレイ機能（読み取り専用）

### 36. 統計機能
- [ ] 🧪 統計計算テスト
- [ ] 📝 統計計算バッチ
- [ ] 📝 統計API実装
- [ ] 📝 統計ダッシュボード

### 37. UI/UX改善
- [ ] 📝 カードアニメーション改善
- [ ] 📝 効果音追加
- [ ] 📝 ツールチップ追加
- [ ] 📝 キーボードショートカット

---

## Phase 4: 品質向上

### 38. パフォーマンス最適化
- [ ] 📝 データベースインデックス追加
- [ ] 📝 クエリ最適化
- [ ] 📝 フロントエンド最適化
- [ ] 🧪 負荷テスト

### 39. セキュリティ
- [ ] 📝 入力値検証強化
- [ ] 📝 レート制限実装
- [ ] 🧪 セキュリティテスト

### 40. 運用準備
- [ ] 📝 環境変数ドキュメント
- [ ] 📝 デプロイ手順書
- [ ] 📝 監視設定
- [ ] 📝 バックアップ設定

---

## 完了基準
- すべてのテストがパスすること
- ESLint/TypeScriptエラーがないこと
- ドキュメントが最新であること
- コードレビューが完了していること