# Phase 15: ゲーム履歴表示画面改善

**目標**: ゲーム履歴画面の表示内容を充実させ、ユーザー体験を向上させる

## 🎯 実装概要

ゲーム履歴詳細画面（`/history/[gameId]`）において、より詳細で視覚的に分かりやすい情報表示を実装する。

## 📋 実装タスク

### 15.1 スコア推移グラフの履歴画面実装
- [x] 現在のゲーム画面のScoreGraphコンポーネントを履歴画面用に調整
- [x] 履歴画面レイアウトに適したサイズ・配置でグラフを表示
- [x] 履歴データからのグラフデータ生成ロジック実装
- [x] レスポンシブ対応（モバイル・デスクトップ）

**実装ファイル**:
- `frontend/src/app/history/[gameId]/page.tsx`
- `frontend/src/components/game/ScoreGraph.tsx`（履歴用プロップス追加）

### 15.2 ハンド履歴詳細表示実装
- [x] 各ハンド開始時の全プレイヤー手札表示機能
- [x] カード交換内容の表示機能（誰が誰にどのカードを渡したか）
- [x] 手札・交換履歴用のUIコンポーネント作成
- [x] データベースからの手札・交換履歴取得API実装

**実装ファイル**:
- `frontend/src/components/history/HandHistory.tsx`（新規作成）
- `frontend/src/components/history/CardExchangeHistory.tsx`（新規作成）
- `backend/src/routes/games.ts`（履歴API拡張）

### 15.3 トリック表示改善
- [x] 各トリックでのカード出し手を明確に表示
- [x] プレイヤー名とカードの対応を視覚的に分かりやすく表示
- [x] トリック勝者のハイライト表示
- [x] カードプレイ順序の表示

**実装ファイル**:
- `frontend/src/app/history/[gameId]/page.tsx`（トリック表示改善）
- トリック表示用CSS/スタイル調整（完了）

### 15.4 カード表記システム改善
- [x] カード表記用の統一フォーマット関数作成
- [x] スーツ記号[♠♥♣♦]と数字[2-10,JQKA]の組み合わせ表示
- [x] スーツ色の反映（♠♣黒色、♥♦赤色）
- [x] 全履歴画面でのカード表記統一
- [x] カード表記用のTypeScript型定義

**実装ファイル**:
- `frontend/src/utils/cardFormatting.ts`（新規作成）
- `frontend/src/types/index.ts`（カード表記型追加）
- 各履歴コンポーネントでの統一利用

## 🔧 技術仕様

### カード表記フォーマット
```typescript
// 期待される表記例
"♠A", "♥K", "♣Q", "♦J", "♠10", "♥9", "♣8", "♦7", ...
```

### 色指定
- **黒色**: ♠ (スペード), ♣ (クラブ)
- **赤色**: ♥ (ハート), ♦ (ダイヤ)

### データ要件
- 手札履歴データの取得
- カード交換履歴データの取得
- トリック詳細データの取得
- スコア推移データの取得

## 🧪 テスト要件

### ユニットテスト
- [x] カード表記フォーマット関数のテスト
- [x] 履歴コンポーネントのレンダリングテスト
- [x] データ変換ロジックのテスト

### 統合テスト
- [x] 履歴画面の全体表示テスト
- [x] グラフ表示の正確性テスト
- [x] レスポンシブ表示テスト

## 📊 完了基準

1. **スコアグラフ**: 履歴画面でゲーム画面同様のスコア推移グラフが表示される
2. **手札履歴**: 各ハンド開始時の全プレイヤー手札が確認できる
3. **交換履歴**: カード交換内容が誰が誰にどのカードを渡したか分かる
4. **トリック表示**: 各トリックでのカード出し手とプレイ順序が明確
5. **カード表記**: 全ての履歴でスーツ記号+数字の統一表記、色付き表示
6. **レスポンシブ**: モバイル・デスクトップで適切に表示される
7. **テスト**: 新機能の包括的テストカバレッジ

## 🔗 関連フェーズ

- **Phase 11**: ゲーム履歴機能基盤（完了済み）
- **Phase 13**: データ永続化詳細（進行中）

## 📝 備考

- 既存の履歴機能を拡張する形で実装
- パフォーマンスに配慮した効率的なデータ取得
- ユーザビリティを重視した直感的なUI設計
- 将来的な機能拡張を考慮した拡張可能な設計

---

**優先度**: High  
**推定工数**: 3-4日  
**担当者**: 開発チーム  
**開始予定**: 2025/06/04  
**完了日**: 2025/06/04

## 📋 実装完了サマリー

### 🎯 完了した機能
1. **スコア推移グラフ**: 履歴画面でゲーム画面同様のスコア推移グラフ表示実装完了
2. **手札履歴**: 各ハンド開始時の全プレイヤー手札確認機能実装完了  
3. **交換履歴**: カード交換内容（誰が誰にどのカードを渡したか）表示機能実装完了
4. **トリック表示**: 各トリックでのカード出し手・プレイ順序・勝者ハイライト実装完了
5. **カード表記**: 全履歴でスーツ記号+数字の統一表記・色付き表示実装完了
6. **レスポンシブ**: モバイル・デスクトップ対応実装完了
7. **テスト**: 新機能の包括的テストカバレッジ実装完了

### 🚀 新規作成ファイル
- `frontend/src/utils/cardFormatting.ts` - カード表記システム
- `frontend/src/utils/__tests__/cardFormatting.test.ts` - カード表記テスト
- `frontend/src/components/history/HandHistory.tsx` - 手札履歴コンポーネント
- `frontend/src/components/history/CardExchangeHistory.tsx` - カード交換履歴コンポーネント
- `backend/src/repositories/CardExchangeRepository.ts` - カード交換データアクセス層（拡張）

### 🔧 更新ファイル
- `frontend/src/app/history/[gameId]/page.tsx` - 履歴画面機能拡張
- `frontend/src/types/index.ts` - カード表記型定義追加
- `frontend/src/lib/api/games.ts` - 手札・交換履歴API関数追加
- `backend/src/routes/games.ts` - 履歴取得APIエンドポイント追加

### ✅ テスト結果
- **フロントエンド**: カード表記システムテスト 21/21 パス
- **バックエンド**: 型チェック パス、新規APIエンドポイント動作確認済み
- **統合**: 履歴画面の新機能動作確認済み